<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ninja Shopper Agent Prototype</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Hide scrollbar for clean UI */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-[#f0f0f0]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Helper component to render icons in a standalone HTML file
        const Icon = ({ name, size = 24, className = "", strokeWidth = 2, fill = "none" }) => {
            const iconRef = useRef(null);
            
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    iconRef.current.innerHTML = `<i data-lucide="${name}" class="${className}" style="width:${size}px; height:${size}px; stroke-width:${strokeWidth}; fill:${fill};"></i>`;
                    window.lucide.createIcons({ root: iconRef.current });
                }
            }, [name, size, className, strokeWidth, fill]);

            return <span ref={iconRef} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }}></span>;
        };

        const App = () => {
            // --- GEMINI API CONFIG ---
            const apiKey = ""; // Add API key if needed, or leave empty for mock responses
            const model = "gemini-2.5-flash-preview-09-2025";

            const callGemini = async (prompt, systemInstruction = "") => {
                // If no API key is provided, simulate a response so the prototype doesn't break for the team
                if(!apiKey) {
                    console.warn("No API Key provided. Returning mock response.");
                    return new Promise(resolve => setTimeout(() => resolve("Analyzed intent: Shopping for event."), 800));
                }

                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: { parts: [{ text: systemInstruction }] }
                };

                let delay = 1000;
                for (let i = 0; i < 5; i++) {
                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const result = await response.json();
                        return result.candidates?.[0]?.content?.parts?.[0]?.text;
                    } catch (error) {
                        if (i === 4) throw error;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    }
                }
            };

            // --- STATE ---
            const [view, setView] = useState('home'); 
            const [activeBrand, setActiveBrand] = useState('ninja'); 
            const [messages, setMessages] = useState([]);
            const [currentStep, setCurrentStep] = useState(0);
            const [isTyping, setIsTyping] = useState(false);
            const [inputValue, setInputValue] = useState("");
            const [aiAnalyzing, setAiAnalyzing] = useState(false);
            const [recipeLoading, setRecipeLoading] = useState(false);
            const [showRecipeModal, setShowRecipeModal] = useState(null);
            const [showProductModal, setShowProductModal] = useState(null); 
            const [paymentProcessing, setPaymentProcessing] = useState(false); 
            const [aiBrainInsight, setAiBrainInsight] = useState("Waiting for input...");
            const [cartCount, setCartCount] = useState(0);
            const [cartItems, setCartItems] = useState([]); 
            const [activeCategory, setActiveCategory] = useState('airfryer'); 
            const [scrollToResults, setScrollToResults] = useState(false);
            
            const [diagnosticSelections, setDiagnosticSelections] = useState({
                size: null, layout: null, type: null,
                blender_size: null, blender_type: null, blender_tech: null
            });
            
            const [userProfile, setUserProfile] = useState({
                name: "Bhagath",
                demographic: "Male, Mid-30s",
                location: "San Ramon, CA",
                ownedProducts: ["Ninja Creami"],
                preferences: {}
            });

            const chatEndRef = useRef(null);
            const resultsTopRef = useRef(null);

            // --- MOCK DATA ---
            const dataCategories = [
                { id: 1, name: "Shopper Profile", status: "Active", detail: "Mid-30s Male / Efficiency Seeker" },
                { id: 2, name: "Order History", status: "Active", detail: "Ninja Creami Owner" },
                { id: 5, name: "‚ú® AI Intent Analysis", status: "Active", detail: aiBrainInsight },
                { id: 6, name: "Logistics", status: "Active", detail: "Prioritizing Fast Delivery" },
                { id: 8, name: "Review Insights", status: "Active", detail: "Grounded in Ninja Corpus" },
            ];

            const categoryInsights = [
                { title: "Crispi‚Ñ¢ Pro Glass Series", consensus: "Unmatched visibility & 'Snap-and-Store' ease.", bestFor: "Aesthetic kitchens & health-focused meal prep." },
                { title: "DoubleStack‚Ñ¢ Series", consensus: "Obsessed with footprint-to-volume ratio.", bestFor: "Urban professionals & narrow counters." },
                { title: "DualZone‚Ñ¢ Series", consensus: "Highest-rated for 'Life-Changing Utility'.", bestFor: "Families & multi-part meal timing." },
                { title: "Ninja Professional Plus", consensus: "Best-in-class ice crushing for margaritas.", bestFor: "Party hosts & large batches." }
            ];

            const allProducts = [
                { id: 'crispi-pro-cyberspace', category: 'airfryer', name: "Ninja Crispi‚Ñ¢ Pro 6-in-1 Glass Air Fryer (Cyberspace)", tag: "Best Seller", type: 'glass', size: 'large', layout: 'wide', description: "Sleek Cyberspace finish. 6-in-1 functionality with high-visibility glass. Cook, monitor, and store in the same bowl.", price: "$199.99", promoPrice: "$159.99", image: "https://i.ibb.co/wNczzcgx/slate-glass-airfryer.png", fallbackImage: "https://images.unsplash.com/photo-1626074353765-517a681e40be?auto=format&fit=crop&q=80&w=600", rating: 4.9 },
                { id: 'crispi-pro-rose', category: 'airfryer', name: "Ninja Crispi‚Ñ¢ Pro 6-in-1 Glass Air Fryer (Rose Quartz)", tag: "Trending Color", type: 'glass', size: 'large', layout: 'wide', description: "Elegant Rose Quartz edition. Perfect for modern aesthetics while offering professional 6-in-1 roasting and air frying.", price: "$199.99", promoPrice: "$159.99", image: "https://i.ibb.co/gLSY31kH/rose-glass-airfryer.png", fallbackImage: "https://images.unsplash.com/photo-1598103442097-8b74394b95c6?auto=format&fit=crop&q=80&w=600", rating: 4.8 },
                { id: 'crispi-pro-bone', category: 'airfryer', name: "Ninja Crispi‚Ñ¢ Pro 6-in-1 Glass Air Fryer (Bone)", tag: "Classic Finish", type: 'glass', size: 'large', layout: 'wide', description: "Deep Charcoal finish. Features a heat-resistant clear glass basket and 'Keep Warm' functionality for party hosting.", price: "$199.99", promoPrice: "$159.99", image: "https://i.ibb.co/NdqztvhF/bone-glass-airfryer.png", fallbackImage: "https://images.unsplash.com/photo-1585238341267-1cfec2046a55?auto=format&fit=crop&q=80&w=600", rating: 4.9 },
                { id: 'blender-system', category: 'blender', name: "Ninja¬Æ Professional Plus Kitchen System with Auto-iQ¬Æ", tag: "Total Kitchen Solution", type: 'system', description: "72 oz. Pitcher, 64 oz. Processor Bowl, and single-serve cups. Features Auto-iQ technology for one-touch intelligence.", price: "$219.99", promoPrice: "$199.99", image: "https://i.ibb.co/Cpnz6Gt4/Gemini-Generated-Image-ygn232ygn232ygn2.png", rating: 4.9 },
                { id: 'blender-ultimate', category: 'blender', name: "Ninja¬Æ Foodi¬Æ Power Blender Ultimate System", tag: "The Do-It-All", type: 'system', description: "Crushes, processes, and makes dough. Enhanced processing lid and nutrient extraction cups for versatility.", price: "$239.99", promoPrice: "$219.99", image: "https://i.ibb.co/tpQ3hNNp/Gemini-Generated-Image-cpe9r9cpe9r9cpe9.png", rating: 4.8 },
                { id: 'blender-detect', category: 'blender', name: "Ninja Detect‚Ñ¢ Kitchen System Power Blender Plus Processor Pro", tag: "Smartest Blender", type: 'system', description: "Features BlendSense‚Ñ¢ Technology that automatically adjusts speed and time for perfectly smooth results. No guesswork.", price: "$229.99", promoPrice: "$189.99", image: "https://i.ibb.co/Pz1z14C2/Gemini-Generated-Image-8rb91o8rb91o8rb9.png", rating: 5.0 },
                { id: 'acc-creami-pints', category: 'accessory', name: "Ninja¬Æ Creami¬Æ Pints (2-Pack)", tag: "Essential Add-on", type: 'storage', description: "Extra pints for your Ninja Creami. Pre-freeze more flavors for Gameday so you never run out.", price: "$29.99", promoPrice: "$24.99", image: "https://i.ibb.co/qMQ8qcFt/Screenshot-2026-02-10-at-12-33-23-AM.png", rating: 4.8 },
                { id: 'acc-cleancrisp', category: 'accessory', name: "6-QT CleanCrisp‚Ñ¢ Container", tag: "Prep & Store", type: 'storage', description: "Extra glass vessel for your Crispi system. Prep your wings ahead of time and swap baskets instantly during the party.", price: "$34.99", promoPrice: "$29.99", image: "https://i.ibb.co/r2Q7Z17m/Gemini-Generated-Image-347dje347dje347d.png", rating: 4.9 },
                { id: 'acc-blender-cups', category: 'accessory', name: "24 oz. Single-Serve Cups (2-Pack)", tag: "Perfect Portions", type: 'storage', description: "Extra cups with spout lids. Perfect for taking your Gameday margaritas or morning smoothies on the go.", price: "$24.99", promoPrice: "$19.99", image: "https://images.unsplash.com/photo-1570222094114-d054a817e56b?auto=format&fit=crop&q=80&w=600", fallbackImage: "https://images.unsplash.com/photo-1570222094114-d054a817e56b?auto=format&fit=crop&q=80&w=600", rating: 4.8 }
            ];

            // --- LOGIC ---
            useEffect(() => {
                if (messages.length === 0) {
                    setMessages([{ 
                        role: 'agent', 
                        content: `Hi ${userProfile.name}! üåßÔ∏è It's a rainy day in San Ramon‚Äîperfect for staying in. \n\nSince you love your Creami, I've curated some upgrades for your kitchen just in time for the Big Game. What's on your prep list?`,
                        options: [
                        { label: "Airfryer for party wings üçó", value: "start_airfryer" },
                        { label: "Blender for margaritas üçπ", value: "start_blender" },
                        { label: "Indoor Grill for burgers üçî", value: "start_grill" }
                        ]
                    }]);
                    setCurrentStep(0); 
                }
            }, [userProfile.name]);

            const handleSendMessage = async (e) => {
                if (e) e.preventDefault();
                if (!inputValue.trim()) return;

                setScrollToResults(false);
                const userText = inputValue;
                setMessages(prev => [...prev, { role: 'user', content: userText }]);
                setInputValue("");
                setIsTyping(true);
                setAiAnalyzing(true);

                try {
                    const analysisPrompt = `Analyze: "${userText}". User: ${userProfile.name}. Identify primary intent. Keep response under 10 words.`;
                    const analysis = await callGemini(analysisPrompt, "You are a Shopper Insights analyst.");
                    setAiBrainInsight(analysis || "Extracted intent for local inventory matching.");
                    setAiAnalyzing(false);

                    const lowerText = userText.toLowerCase();

                    setTimeout(() => {
                        if (currentStep === 'waiting_for_airfryer_requirements') {
                            const newPrefs = { ...diagnosticSelections };
                            
                            if (lowerText.includes("large") || lowerText.includes("party") || lowerText.includes("crowd") || lowerText.includes("family")) newPrefs.size = 'large';
                            else if (lowerText.includes("small") || lowerText.includes("just me") || lowerText.includes("1") || lowerText.includes("2")) newPrefs.size = 'small';
                            else newPrefs.size = 'large';

                            if (lowerText.includes("tight") || lowerText.includes("small space") || lowerText.includes("vertical") || lowerText.includes("narrow")) newPrefs.layout = 'vertical';
                            else newPrefs.layout = 'wide';

                            if (lowerText.includes("glass") || lowerText.includes("see") || lowerText.includes("watch") || lowerText.includes("window")) newPrefs.type = 'glass';
                            else if (lowerText.includes("metal") || lowerText.includes("classic")) newPrefs.type = 'metal';
                            else newPrefs.type = 'glass';

                            setDiagnosticSelections(newPrefs);
                            setMessages(prev => [...prev, { role: 'agent', content: `Got it! Looking for a ${newPrefs.size} capacity, ${newPrefs.layout === 'vertical' ? 'space-saving' : 'standard'} layout, with ${newPrefs.type === 'glass' ? 'ClearCook glass' : 'classic metal'} baskets. <br><br>Here are your best matches:` }]);
                            
                            setTimeout(() => {
                                const products = getFilteredProducts({ ...newPrefs, category: 'airfryer' });
                                setMessages(prev => [...prev, { 
                                    role: 'agent', content: `I've matched specific models for you, Bhagath. Based on your Gameday needs, here are our top-rated <b>${newPrefs.type === 'glass' ? 'Crispi‚Ñ¢ Pro Glass' : 'Air Fryer'}</b> models:`, 
                                    type: 'carousel', products: products, isResultHeader: true
                                }]);
                                setActiveCategory('airfryer');
                                
                                setTimeout(() => {
                                    setMessages(prev => [...prev, {
                                        role: 'agent', content: "How do these look? Since you like the precision of the Creami, I can <b>Filter for Smart Thermometers</b> üå°Ô∏è if you want zero guesswork for your wings, or show <b>Similar Styles</b>.",
                                        options: [ { label: "Filter: Smart Thermometer üå°Ô∏è", value: "smart_probe" }, { label: "Show Similar Styles", value: "similar" }, { label: "They look great!", value: "continue" } ]
                                    }]);
                                    setIsTyping(false);
                                }, 1200);
                                setCurrentStep(3.5); setScrollToResults(true);
                            }, 800);
                            return;
                        }

                        if (currentStep === 'waiting_for_blender_requirements') {
                            const newPrefs = { ...diagnosticSelections };
                            if (lowerText.includes("pitcher") || lowerText.includes("batch") || lowerText.includes("party")) newPrefs.blender_size = 'pitcher';
                            else newPrefs.blender_size = 'personal';

                            if (lowerText.includes("system") || lowerText.includes("process") || lowerText.includes("dough") || lowerText.includes("salsa")) newPrefs.blender_type = 'system';
                            else newPrefs.blender_type = 'drinks';

                            if (lowerText.includes("smart") || lowerText.includes("sense") || lowerText.includes("blendsense")) newPrefs.blender_tech = 'smart';
                            else newPrefs.blender_tech = 'auto_iq';

                            setDiagnosticSelections(newPrefs);
                            const products = getFilteredProducts({ category: 'blender' }); 
                            setMessages(prev => [...prev, { 
                                role: 'agent', content: `Based on your need for ${newPrefs.blender_size === 'pitcher' ? 'party batches' : 'personal drinks'} and ${newPrefs.blender_tech === 'smart' ? 'smart sensing' : 'standard controls'}, here are the top <b>Ninja Blenders</b> available in San Ramon:`, 
                                type: 'carousel', products: products, isResultHeader: true
                            }]);
                            setActiveCategory('blender');
                            setCurrentStep(7); setScrollToResults(true); setAiAnalyzing(false); setIsTyping(false);
                            return;
                        }

                        if (currentStep === 3.5) {
                            if (lowerText.includes("thermometer") || lowerText.includes("smart")) handleUserSelection({value: 'smart_probe'}, true);
                            else handleUserSelection({value: 'continue'}, true);
                        } else if (currentStep === 8) {
                            if (lowerText.includes("show") || lowerText.includes("yes")) handleUserSelection({value: 'show_accessories'}, true);
                            else handleUserSelection({value: 'checkout_skip_acc'}, true);
                        } else {
                            setMessages(prev => [...prev, { role: 'agent', content: "I'm focusing on finding your perfect appliance right now. Could you clarify your preference based on the options?" }]);
                            setAiAnalyzing(false); setIsTyping(false);
                        }
                    }, 1000);
                } catch (err) {
                    setAiAnalyzing(false); setIsTyping(false);
                }
            };

            const handleUserSelection = (option, skipUserMessage) => {
                setScrollToResults(false);
                if (!skipUserMessage) setMessages(prev => [...prev, { role: 'user', content: option.label }]);
                
                const currentVal = option.value;
                if (currentVal === "apple_pay") {
                    simulateApplePay();
                    return;
                }

                setIsTyping(true);

                setTimeout(() => {
                    let response = "";
                    let options = [];

                    if (currentStep === 0) {
                        if (currentVal === "start_airfryer") {
                            setMessages(prev => [...prev, {
                                role: 'agent',
                                content: "Awesome! To match you with the perfect Air Fryer for Gameday, I just need to know 3 things:<br><br><b>Household Size:</b> Are you typically cooking for a large family or just a household of one or two?<br><br><b>Kitchen Space:</b> Are you tight on counter space and looking for a vertical, space-saving design, or do you have plenty of room for a traditional wide model?<br><br><b>Cooking Style:</b> Do you prefer a standard metal basket, or would you like to see our Glass series that lets you monitor your food and store leftovers directly in the fridge?<br><br><i>You can type your answer like: 'I need a large one for a family, wide is fine, and I prefer glass.'</i>",
                            }]);
                            setCurrentStep('waiting_for_airfryer_requirements'); setIsTyping(false); return;
                        } else if (currentVal === "start_blender") {
                            setMessages(prev => [...prev, {
                                role: 'agent',
                                content: "Let's find the right Blender! Tell me:<br><br><b>Serving Size:</b> Do you need a large Pitcher or single-serve Cups?<br><br><b>Usage:</b> Just for drinks, or a full Kitchen System (for salsa/dough)?<br><br><b>Technology:</b> Do you prefer smart BlendSense technology that auto-adjusts to your ingredients, or standard buttons for familiar manual control?<br><br><i>You can say: 'I want a pitcher for margaritas and smart features.'</i>"
                            }]);
                            setCurrentStep('waiting_for_blender_requirements'); setIsTyping(false); return;
                        } else if (currentVal === "start_grill") {
                            response = "Burgers are a Gameday classic! üçî<br><br>Since it's raining in San Ramon, an indoor solution is perfect. Actually, our <b>Crispi‚Ñ¢ Air Fryers</b> are rated even higher for burgers (less smoke!). Would you like to check those out?";
                            options = [ { label: "Show Air Fryers", value: "start_airfryer" }, { label: "Stick to Blenders", value: "start_blender" } ];
                            setCurrentStep(0); 
                        }
                    } 
                    else if (currentStep === 3.5) {
                        if (currentVal === "smart_probe") {
                            const refinedProducts = allProducts.filter(p => p.category === 'airfryer' && (p.id.includes('cyberspace') || p.id.includes('bone')));
                            setMessages(prev => [...prev, { role: 'agent', content: "Great call. These models include the <b>Foodi‚Ñ¢ Smart Thermometer</b>. Just plug it in, set beef/chicken to your desired doneness, and it stops automatically when perfect.", type: 'carousel', products: refinedProducts, isResultHeader: true }]);
                            setScrollToResults(true);
                        } else if (currentVal === "similar") {
                            const similarProducts = allProducts.filter(p => p.category === 'airfryer' && p.id.includes('rose'));
                            setMessages(prev => [...prev, { role: 'agent', content: "Here are some other popular form factors:", type: 'carousel', products: similarProducts, isResultHeader: true }]);
                            setScrollToResults(true);
                        } else {
                            response = "Glad to hear it! Tap the cart icon on your favorite model to add it, and we'll move on to the drinks! üçπ";
                            setMessages(prev => [...prev, { role: 'agent', content: response }]);
                        }
                        setIsTyping(false); return; 
                    }
                    else if (currentStep === 5) {
                        if (currentVal === "start_blender_flow") {
                            setMessages(prev => [...prev, {
                                role: 'agent',
                                content: "Let's find the right Blender! Tell me:<br><br><b>Serving Size:</b> Do you need a large Pitcher or single-serve Cups?<br><br><b>Usage:</b> Just for drinks, or a full Kitchen System (for salsa/dough)?<br><br><b>Technology:</b> Do you prefer smart BlendSense technology that auto-adjusts to your ingredients, or standard buttons for familiar manual control?<br><br><i>You can say: 'I want a pitcher for margaritas and smart features.'</i>"
                            }]);
                            setCurrentStep('waiting_for_blender_requirements'); setIsTyping(false); return;
                        } else {
                            response = "No problem! Let's get that Air Fryer shipped to you.";
                            options = [{ label: "Buy with Ô£øPay", value: "apple_pay" }];
                            setCurrentStep(9);
                        }
                    } 
                    else if (currentStep === 8) { 
                        if (currentVal === "show_accessories") {
                            const products = allProducts.filter(p => p.category === 'accessory');
                            
                            const total = cartItems.reduce((acc, item) => acc + parseFloat(item.promoPrice.replace('$', '')), 0);
                            const gap = 400 - total;
                            const minAccessoryPrice = Math.min(...products.map(p => parseFloat(p.promoPrice.replace('$', ''))));
                            
                            let contentMsg = "Here are the best accessories to reach that $400 threshold. The <b>Creami Pints</b> are a shopper favorite!";
                            if (gap > 0 && gap < minAccessoryPrice) {
                                contentMsg = `I couldn't find any products under $${Math.ceil(gap)}, but these are some great accessories for you to consider to reach that $400 threshold.`;
                            }
                            
                            setMessages(prev => [...prev, { role: 'agent', content: contentMsg, type: 'carousel', products: products, isResultHeader: true }]);
                            setActiveCategory('accessory'); setScrollToResults(true); setIsTyping(false); return;
                        } else {
                            response = "Understood. Proceeding to checkout with your Air Fryer and Blender.";
                            options = [{ label: "Buy with Ô£øPay", value: "apple_pay" }];
                            setCurrentStep(9);
                        }
                    }

                    if (response) setMessages(prev => [...prev, { role: 'agent', content: response, options }]);
                    setIsTyping(false);
                }, 1000);
            };

            const calculateTotal = (items) => items.reduce((acc, item) => acc + parseFloat(item.promoPrice.replace('$', '')), 0);

            const handleAddToCart = (product) => {
                const updatedCart = [...cartItems, product];
                setCartItems(updatedCart);
                setCartCount(updatedCart.length);
                setScrollToResults(false);
                setIsTyping(true);
                
                if (product.category === 'airfryer') {
                    setTimeout(() => {
                        setMessages(prev => [...prev, {
                            role: 'agent', content: `I've added the <b>${product.name}</b> to your cart! üõí<br><br><b>Gameday Pro Tip:</b> To really nail the party, you'll want restaurant-style margaritas to go with those wings. <br><br>Shall I help you find the <b>Perfect Ninja Blender</b> for your setup?`,
                            options: [ { label: "Yes, find a Blender üçπ", value: "start_blender_flow" }, { label: "No, just Checkout", value: "checkout_skip" } ],
                            isResultHeader: true
                        }]);
                        setCurrentStep(5); setScrollToResults(true); setIsTyping(false);
                    }, 600);
                } else if (product.category === 'blender' || product.category === 'accessory') {
                    const total = calculateTotal(updatedCart);
                    const threshold = 400;
                    setTimeout(() => {
                        if (total < threshold) {
                            const gap = (threshold - total).toFixed(2);
                            const gapCeiling = Math.ceil(parseFloat(gap));
                            
                            setMessages(prev => [...prev, {
                                role: 'agent', content: `<b>${product.name}</b> added. üõí<br><br>Your current cart total is - <b>$${total.toFixed(2)}</b>, and you are <b>$${gap}</b> away from the <b>$50 platinum discount</b>.<br><br>Would you like me to show you products under <b>$${gapCeiling}</b> so you get the discount?`,
                                options: [ { label: "Yes, show products", value: "show_accessories" }, { label: "Proceed to checkout", value: "checkout_skip_acc" } ],
                                isResultHeader: true
                            }]);
                            setCurrentStep(8); setScrollToResults(true);
                        } else {
                            setMessages(prev => [...prev, {
                                role: 'agent', content: `Boom! <b>${product.name}</b> added.<br><br>üéâ <b>Threshold Met!</b> Cart Total: $${total.toFixed(2)}. <br><b>$50 Platinum Discount Unlocked!</b><br><br>Your Gameday bundle is ready.`,
                                options: [ { label: "Buy with Ô£øPay", value: "apple_pay" } ],
                                isResultHeader: true
                            }]);
                            setCurrentStep(9); setScrollToResults(true);
                        }
                        setIsTyping(false);
                    }, 600);
                }
            };

            const simulateApplePay = () => {
                setPaymentProcessing(true);
                const subtotal = cartItems.reduce((acc, item) => acc + parseFloat(item.promoPrice.replace('$', '')), 0);
                let thresholdDiscount = subtotal >= 400 ? 50 : 0;
                const tax = (subtotal - thresholdDiscount) * 0.0975;
                const total = (subtotal - thresholdDiscount) + tax;

                setTimeout(() => setMessages(prev => [...prev, { role: 'agent', type: 'apple_pay_processing' }]), 500);

                setTimeout(() => {
                    setPaymentProcessing(false); setCartCount(0); setCartItems([]);
                    setMessages(prev => {
                        const filtered = prev.filter(m => m.type !== 'apple_pay_processing');
                        const receipt = `‚úÖ <b>Payment Successful</b><br><br><b>Order #SR-99281</b><br>üìç Delivery to San Ramon, CA<br><br>${cartItems.map(i => `‚Ä¢ ${i.name}`).join('<br>')}<br><br><b>Subtotal:</b> $${subtotal.toFixed(2)}<br>${thresholdDiscount > 0 ? `<b>Bulk Discount:</b> -$${thresholdDiscount.toFixed(2)}<br>` : ''}<b>Tax (9.75%):</b> $${tax.toFixed(2)}<br>----------------<br><b>Total:</b> $${total.toFixed(2)}<br><br>Ready for kickoff! üèà`;
                        return [...filtered, { role: 'agent', content: receipt, complete: true }];
                    });
                }, 3000);
            };

            const getFilteredProducts = (filterCriteria) => {
                if (filterCriteria && Array.isArray(filterCriteria)) return filterCriteria;
                let targetCat = activeCategory;
                if (filterCriteria && filterCriteria.category) targetCat = filterCriteria.category;
                if (targetCat === 'blender') return allProducts.filter(p => p.category === 'blender');
                if (targetCat === 'accessory') return allProducts.filter(p => p.category === 'accessory');
                if (targetCat === 'airfryer') {
                    let results = allProducts.filter(p => p.category === 'airfryer');
                    if (filterCriteria?.size) results = results.filter(p => (filterCriteria.size === 'small' ? p.tag.includes('Compact') : !p.tag.includes('Compact')));
                    if (filterCriteria?.type) results = results.filter(p => p.type === filterCriteria.type);
                    return results.slice(0,3);
                }
                return allProducts.filter(p => p.category === 'airfryer');
            };

            const generateRecipe = async (product) => {
                setRecipeLoading(true);
                try {
                    const prompt = `${userProfile.name} owns a ${product.name}. Generate a fun air fryer recipe for a crowd. Title, 3 ingredients, 2 steps.`;
                    const mockRecipe = "üèà Gameday Garlic Parmesan Wings\n\nIngredients:\n- 2 lbs Chicken Wings\n- 1/4 cup Grated Parmesan\n- 1 tbsp Garlic Powder\n\nSteps:\n1. Toss wings in a bowl with a little oil. Set Air Fryer to 390¬∞F and cook for 20 mins, flipping halfway.\n2. In a clean bowl, toss the hot, crispy wings with the garlic powder and parmesan until coated. Serve immediately!";
                    let recipe = mockRecipe;
                    if(apiKey) { try { recipe = await callGemini(prompt, "You are a professional chef."); } catch(e){} }
                    setShowRecipeModal({ product, content: recipe });
                } catch (err) { console.error(err); } finally { setRecipeLoading(false); }
            };

            useEffect(() => {
                const timer = setTimeout(() => {
                    if (scrollToResults && !isTyping) resultsTopRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    else chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
                }, 100);
                return () => clearTimeout(timer);
            }, [messages, isTyping, paymentProcessing, scrollToResults]);

            return (
                <div className="flex h-screen bg-[#f0f0f0] justify-center overflow-hidden font-sans">
                    <div className="relative w-full max-w-[420px] h-full bg-white shadow-[0_40px_100px_rgba(0,0,0,0.2)] overflow-hidden flex flex-col border-x border-slate-200">
                        {view === 'home' ? (
                            <div className="flex flex-col h-full bg-white text-[#1a1a1a] pb-24 overflow-y-auto overflow-x-hidden scrollbar-hide relative">
                                <div className="bg-[#f8f8f8] px-4 py-2 flex items-center justify-between border-b border-slate-100 shrink-0">
                                    <div className="flex items-center gap-6">
                                        <button onClick={() => setActiveBrand('shark')} className={`text-[10px] font-bold uppercase tracking-widest pb-1 transition-all ${activeBrand === 'shark' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-400'}`}>Shark</button>
                                        <button onClick={() => setActiveBrand('ninja')} className={`text-[10px] font-bold uppercase tracking-widest pb-1 transition-all ${activeBrand === 'ninja' ? 'text-green-600 border-b-2 border-green-600' : 'text-slate-400'}`}>Ninja</button>
                                    </div>
                                    <div className="flex items-center gap-4 text-slate-400"><span className="text-[10px] font-medium">Support</span><span className="text-[10px] font-medium">Register</span></div>
                                </div>
                                <nav className="sticky top-0 z-50 bg-white/95 backdrop-blur px-4 py-4 flex items-center justify-between border-b border-slate-100 shrink-0">
                                    <div className="flex items-center gap-4">
                                        <Icon name="menu" className="text-[#1a1a1a]" />
                                        <div className="text-2xl font-black tracking-tighter uppercase leading-none italic">{activeBrand === 'ninja' ? 'NINJA' : 'SHARK'}</div>
                                    </div>
                                    <div className="flex items-center gap-5">
                                        <Icon name="search" className="text-[#1a1a1a]" strokeWidth={1.5} />
                                        <Icon name="heart" className="text-[#1a1a1a]" strokeWidth={1.5} />
                                        <div className="relative">
                                            <Icon name="shopping-cart" className="text-[#1a1a1a]" strokeWidth={1.5} />
                                            {cartCount > 0 && <span className="absolute -top-1 -right-1 bg-[#1a1a1a] text-white text-[8px] font-bold w-4 h-4 rounded-full flex items-center justify-center transition-all duration-300 transform scale-100">{cartCount}</span>}
                                        </div>
                                    </div>
                                </nav>
                                <section className="relative w-full aspect-[4/5] bg-[#1a1a1a] overflow-hidden flex flex-col justify-end p-8 shrink-0">
                                    <img src={activeBrand === 'ninja' ? "https://images.unsplash.com/photo-1626074353765-517a681e40be?q=80&w=1200&auto=format&fit=crop" : "https://images.unsplash.com/photo-1558317374-067fb5f30001?q=80&w=1200&auto=format&fit=crop"} alt="Featured" className="absolute inset-0 w-full h-full object-cover opacity-80" />
                                    <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent"></div>
                                    <div className="relative z-10 space-y-4">
                                        <div className="inline-block px-3 py-1 bg-white/10 backdrop-blur text-white text-[9px] font-bold uppercase tracking-widest rounded border border-white/20">{activeBrand === 'ninja' ? 'Gameday Essentials' : 'Deep Cleaning Pro'}</div>
                                        <h2 className="text-5xl font-black text-white leading-[0.85] tracking-tighter uppercase italic drop-shadow-2xl">{activeBrand === 'ninja' ? 'Win the\nBig Game' : 'PowerDetect‚Ñ¢ Pro'}</h2>
                                        <p className="text-slate-300 text-sm max-w-[280px] leading-tight font-medium">{activeBrand === 'ninja' ? "Prep party-sized batches in half the time." : "Intelligent dirt detection. Up to 70 min power."}</p>
                                        <div className="flex gap-3 pt-2">
                                            <button className="flex-1 bg-white text-black py-4 rounded-full font-black text-[11px] uppercase tracking-widest shadow-xl transition-all active:scale-95">Shop Now</button>
                                            <button className="flex-1 border border-white/50 text-white py-4 rounded-full font-black text-[11px] uppercase tracking-widest backdrop-blur-md active:scale-95">Explore</button>
                                        </div>
                                    </div>
                                </section>
                                <section className="px-6 pt-10 pb-6 shrink-0">
                                    <div className="flex items-end justify-between mb-8">
                                        <div><h3 className="text-2xl font-black italic uppercase tracking-tighter leading-none">Shop {activeBrand === 'ninja' ? 'Kitchen' : 'Cleaning'}</h3><p className="text-slate-400 text-[10px] uppercase font-bold tracking-widest mt-2">Bestselling Categories</p></div>
                                        <Icon name="chevron-right" className="text-slate-300" />
                                    </div>
                                    <div className="flex gap-6 overflow-x-auto scrollbar-hide px-1 pb-4">
                                        {[
                                            { name: activeBrand === 'ninja' ? 'Air Fryers' : 'Cordless Vacs', img: activeBrand === 'ninja' ? "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5" : "https://images.unsplash.com/photo-1558317374-067fb5f30001" },
                                            { name: activeBrand === 'ninja' ? 'Blenders' : 'Robot Vacs', img: activeBrand === 'ninja' ? "https://images.unsplash.com/photo-1570222094114-d054a817e56b" : "https://images.unsplash.com/photo-1589652717521-10c0d092dea9" },
                                            { name: activeBrand === 'ninja' ? 'Indoor Grills' : 'Mops', img: activeBrand === 'ninja' ? "https://images.unsplash.com/photo-1529692236671-f1f6e9460272" : "https://images.unsplash.com/photo-1584622650111-993a426fbf0a" },
                                            { name: activeBrand === 'ninja' ? 'Coffee Makers' : 'Air Purifiers', img: activeBrand === 'ninja' ? "https://images.unsplash.com/photo-1559056199-641a0ac8b55e" : "https://images.unsplash.com/photo-1585238341267-1cfec2046a55" }
                                        ].map((cat, i) => (
                                        <div key={i} className="flex flex-col items-center gap-3 shrink-0">
                                            <div className="w-24 h-24 rounded-full bg-[#f8f8f8] border border-slate-100 overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                                <img src={`${cat.img}?q=80&w=200&auto=format&fit=crop`} alt={cat.name} className="w-full h-full object-cover" />
                                            </div>
                                            <p className="text-[10px] font-black uppercase tracking-tight text-slate-800">{cat.name}</p>
                                        </div>
                                        ))}
                                    </div>
                                </section>
                                <section className="mx-6 p-8 bg-[#1a1a1a] rounded-[2rem] text-white relative overflow-hidden mt-6 mb-12 shadow-2xl shrink-0">
                                    <Icon name="zap" className="absolute -top-6 -right-6 text-white/5" size={128} />
                                    <div className="relative z-10 space-y-4">
                                        <div className="flex items-center gap-2 text-green-400"><Icon name="star" size={14} fill="currentColor" /><span className="text-[10px] font-black uppercase tracking-widest">San Ramon Exclusive</span></div>
                                        <h3 className="text-3xl font-black italic tracking-tighter uppercase leading-none">Rainy Day Upgrade?</h3>
                                        <p className="text-slate-400 text-xs leading-relaxed max-w-[200px]">We noticed it's pouring in San Ramon üåßÔ∏è. Get free <span className="text-white font-bold">Same-Day Delivery</span> on all Gameday appliances to prep before kickoff.</p>
                                        <div className="pt-2 text-[9px] text-blue-400 font-bold uppercase tracking-widest">Complete Your Creami Kitchen</div>
                                    </div>
                                </section>
                                <button onClick={() => setView('chat')} className="absolute bottom-6 right-6 w-16 h-16 bg-[#1a1a1a] text-white rounded-full shadow-[0_10px_40px_rgba(0,0,0,0.3)] flex items-center justify-center hover:scale-110 transition-transform active:scale-95 z-[100] group">
                                    <Icon name="bot" size={30} strokeWidth={2.5} />
                                </button>
                            </div>
                        ) : (
                            <div className="flex flex-col h-full bg-white relative animate-in fade-in slide-in-from-right-10 duration-500">
                                <div className="px-6 py-5 border-b border-slate-100 flex items-center justify-between bg-white/90 backdrop-blur-xl sticky top-0 z-10 shrink-0">
                                    <div className="flex items-center gap-3">
                                        <button onClick={() => setView('home')} className="p-2 -ml-2 hover:bg-slate-50 rounded-full transition-colors"><Icon name="x" size={20} className="text-slate-400" /></button>
                                        <div className="w-10 h-10 rounded-full bg-[#1a1a1a] flex items-center justify-center text-white shadow-lg"><Icon name="bot" size={22} /></div>
                                        <div><h1 className="font-black text-sm uppercase italic tracking-tighter">Shopper Agent V4</h1><div className="flex items-center gap-1.5 text-[9px] text-slate-500 font-bold uppercase tracking-widest"><span className="flex items-center gap-1 text-blue-600"><Icon name="map-pin" size={10} /> San Ramon</span><span className="w-0.5 h-0.5 rounded-full bg-slate-300"></span><span className="flex items-center gap-1"><Icon name="cloud-rain" size={10} /> 58¬∞F</span></div></div>
                                    </div>
                                    <div className="relative">
                                        <Icon name="shopping-cart" className="text-[#1a1a1a]" size={22} strokeWidth={1.5} />
                                        {cartCount > 0 && <span className="absolute -top-1 -right-1 bg-blue-600 text-white text-[8px] font-bold w-4 h-4 rounded-full flex items-center justify-center transition-all duration-300">{cartCount}</span>}
                                    </div>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6 space-y-6 scroll-smooth scrollbar-hide">
                                    {messages.map((msg, idx) => (
                                        <div key={idx} ref={msg.isResultHeader ? resultsTopRef : null} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in slide-in-from-bottom-4 duration-500 scroll-mt-24`}>
                                            <div className={`max-w-[95%] flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                                                <div className={`w-8 h-8 rounded-full shrink-0 flex items-center justify-center text-white shadow-md ${msg.role === 'user' ? 'bg-blue-600' : 'bg-[#1a1a1a]'}`}>{msg.role === 'user' ? <Icon name="user" size={16} /> : <Icon name="bot" size={16} />}</div>
                                                <div className="space-y-3 w-full">
                                                    {msg.type === 'apple_pay_processing' ? (
                                                        <div className="p-6 bg-white border border-slate-200 rounded-3xl shadow-xl flex flex-col items-center justify-center gap-4 animate-in zoom-in duration-300">
                                                            <div className="w-16 h-16 rounded-full bg-black text-white flex items-center justify-center"><Icon name="smartphone" size={32} className="animate-pulse" /></div>
                                                            <div className="text-center space-y-1"><p className="font-black text-sm uppercase tracking-widest">Processing</p><p className="text-[10px] text-slate-500 font-medium">Face ID Verified</p></div>
                                                            <Icon name="loader-2" size={24} className="animate-spin text-slate-300" />
                                                        </div>
                                                    ) : (
                                                        <div className={`px-5 py-3.5 rounded-3xl shadow-sm text-sm leading-relaxed whitespace-pre-wrap ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-[#f4f4f4] text-[#1a1a1a] rounded-tl-none font-medium'}`}>
                                                            {msg.content && typeof msg.content === 'string' ? <div dangerouslySetInnerHTML={{__html: msg.content}} /> : msg.content}
                                                        </div>
                                                    )}
                                                    {msg.type === 'carousel' && (
                                                        <div className="flex gap-4 overflow-x-auto pb-6 scrollbar-hide -mx-2 px-2 snap-x animate-in slide-in-from-right-8 duration-700">
                                                            {(msg.products || getFilteredProducts({})).map(prod => (
                                                                <div key={prod.id} className="min-w-[280px] w-[280px] bg-white rounded-[2rem] overflow-hidden border border-slate-100 shadow-2xl flex flex-col snap-center relative group">
                                                                    <div className="relative h-48 overflow-hidden cursor-pointer bg-white" onClick={() => setShowProductModal(prod)}>
                                                                        <img src={prod.image} className="h-full w-full object-contain p-4 transition-transform duration-700 group-hover:scale-105" alt={prod.name} onError={(e) => { e.target.onerror = null; e.target.src = prod.fallbackImage || "https://images.unsplash.com/photo-1598103442097-8b74394b95c6?q=80&w=600&auto=format&fit=crop"; }} />
                                                                        <div className="absolute top-4 right-4 bg-white/90 backdrop-blur px-2 py-1 rounded-lg text-[10px] font-black flex items-center gap-1 shadow-sm"><Icon name="star" size={10} className="text-orange-500" fill="currentColor" /> {prod.rating}</div>
                                                                        <div className="absolute bottom-4 right-4 bg-white/20 backdrop-blur p-1.5 rounded-full text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity"><Icon name="maximize-2" size={14}/></div>
                                                                    </div>
                                                                    <div className="p-6 flex flex-col flex-1">
                                                                        <h4 className="font-black text-xs uppercase italic tracking-tighter mb-1">{prod.name}</h4>
                                                                        <p className="text-[9px] text-blue-600 mb-3 font-bold uppercase tracking-widest">{prod.tag}</p>
                                                                        <p className="text-[10px] text-slate-500 line-clamp-2 mb-4 font-medium leading-tight italic">"{prod.description}"</p>
                                                                        <div className="mt-auto space-y-4">
                                                                            <div className="flex items-center justify-between">
                                                                                <div className="flex flex-col"><span className="text-[10px] text-slate-400 line-through leading-none font-bold tracking-tighter">{prod.price}</span><span className="font-black text-lg text-[#1a1a1a] tracking-tighter leading-none">{prod.promoPrice}</span></div>
                                                                                <button onClick={() => handleAddToCart(prod)} className="w-10 h-10 bg-[#1a1a1a] text-white rounded-full flex items-center justify-center hover:bg-blue-600 transition-all shadow-xl active:scale-95"><Icon name="shopping-cart" size={18}/></button>
                                                                            </div>
                                                                            <button onClick={() => generateRecipe(prod)} disabled={recipeLoading} className="w-full py-3 bg-slate-50 hover:bg-slate-100 text-[#1a1a1a] text-[10px] font-black uppercase tracking-widest rounded-xl border border-slate-200 flex items-center justify-center gap-2 transition-all disabled:opacity-50">{recipeLoading ? <Icon name="loader-2" size={12} className="animate-spin" /> : <Icon name="sparkles" size={12} />}‚ú® Smart Chef Insights</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                    {msg.options && msg.type !== 'diagnostic_bubble' && (
                                                        <div className="flex flex-wrap gap-2">
                                                            {msg.options.map((opt, oIdx) => (
                                                                <button key={oIdx} onClick={() => handleUserSelection(opt)} className={`px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-widest shadow-sm transition-all active:scale-95 ${opt.value === 'apple_pay' ? 'bg-black text-white border-2 border-black flex items-center gap-2' : 'bg-white border-2 border-slate-100 hover:border-[#1a1a1a] hover:text-[#1a1a1a]'}`}>
                                                                    {opt.label}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                    {isTyping && <div className="flex gap-2 items-center text-slate-400 text-[10px] font-black uppercase tracking-[0.2em]"><Icon name="loader-2" size={14} className="animate-spin text-blue-500"/> {aiAnalyzing ? "‚ú® Parsing DNA..." : "Think Logic..."}</div>}
                                    <div ref={chatEndRef} />
                                </div>
                                <form onSubmit={handleSendMessage} className="p-6 border-t border-slate-100 bg-white/50 backdrop-blur-md">
                                    <div className="relative">
                                        <input type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)} placeholder={`Talk to your personal assistant, ${userProfile.name}...`} className="w-full bg-[#f4f4f4] border-none rounded-2xl px-6 py-4 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/10 placeholder:text-slate-400 font-medium" />
                                        <button type="submit" className="absolute right-3 top-1/2 -translate-y-1/2 p-2.5 bg-[#1a1a1a] text-white rounded-xl shadow-xl transition-all active:scale-90 disabled:opacity-50"><Icon name="send" size={16} /></button>
                                    </div>
                                </form>
                                {showProductModal && (
                                    <div className="absolute inset-0 z-[100] bg-white flex flex-col animate-in slide-in-from-bottom duration-300">
                                        <div className="relative h-[45%] bg-white">
                                            <img src={showProductModal.image} className="w-full h-full object-contain p-8" alt={showProductModal.name} onError={(e) => { e.target.onerror = null; e.target.src = showProductModal.fallbackImage || "https://images.unsplash.com/photo-1598103442097-8b74394b95c6?q=80&w=600&auto=format&fit=crop"; }} />
                                            <button onClick={() => setShowProductModal(null)} className="absolute top-6 right-6 w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-lg"><Icon name="x" size={20}/></button>
                                        </div>
                                        <div className="flex-1 p-8 overflow-y-auto">
                                            <div className="flex justify-between items-start mb-4">
                                                <div><p className="text-blue-600 text-[10px] font-black uppercase tracking-widest mb-1">{showProductModal.tag}</p><h2 className="text-2xl font-black text-[#1a1a1a] uppercase italic leading-none">{showProductModal.name}</h2></div>
                                                <div className="flex flex-col items-end"><span className="text-xl font-black text-[#1a1a1a]">{showProductModal.promoPrice}</span><span className="text-xs text-slate-400 line-through">{showProductModal.price}</span></div>
                                            </div>
                                            <p className="text-sm text-slate-600 font-medium leading-relaxed mb-8">{showProductModal.description}</p>
                                            <button onClick={() => { handleAddToCart(showProductModal); setShowProductModal(null); }} className="w-full py-4 bg-[#1a1a1a] text-white rounded-full font-black text-xs uppercase tracking-[0.2em] shadow-xl active:scale-95 transition-all mb-4">Add to Cart</button>
                                        </div>
                                    </div>
                                )}
                                {showRecipeModal && (
                                    <div className="absolute inset-0 z-[100] bg-black/60 backdrop-blur-md flex items-center justify-center p-6 animate-in fade-in duration-300">
                                        <div className="bg-white w-full max-w-sm rounded-[2.5rem] overflow-hidden shadow-2xl animate-in zoom-in duration-300">
                                            <div className="bg-[#1a1a1a] p-5 flex justify-between items-center"><div className="flex items-center gap-2"><Icon name="chef-hat" className="text-blue-400" size={20} /><h3 className="text-white font-black text-[10px] uppercase tracking-[0.2em]">Chef Grounding</h3></div><button onClick={() => setShowRecipeModal(null)} className="text-slate-500 hover:text-white transition-colors"><Icon name="x" size={22}/></button></div>
                                            <div className="p-8 space-y-6"><div className="bg-slate-50 border border-slate-100 p-6 rounded-3xl"><p className="text-[10px] font-black text-blue-600 mb-2 uppercase tracking-widest flex items-center gap-2"><Icon name="sparkles" size={12}/> AI Recipe for {showRecipeModal.product.name}</p><div className="text-slate-800 text-sm leading-relaxed whitespace-pre-line font-bold italic tracking-tight">{showRecipeModal.content}</div></div><button onClick={() => setShowRecipeModal(null)} className="w-full py-4 bg-[#1a1a1a] text-white rounded-full font-black text-[11px] uppercase tracking-[0.2em] shadow-xl active:scale-95 transition-all">Let's Cook</button></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                    <div className="hidden xl:flex w-[480px] flex-col bg-[#0a0a0a] text-white border-l border-white/5 shrink-0 shadow-[-20px_0_50px_rgba(0,0,0,0.5)]">
                        <div className="p-8 border-b border-white/5 flex items-center justify-between bg-black/40 backdrop-blur-xl">
                            <div className="flex items-center gap-3"><div className="p-2 bg-blue-500/10 rounded-xl"><Icon name="database" className="text-blue-500" size={20} /></div><div><h2 className="font-black uppercase tracking-[0.25em] text-[10px] text-blue-400">Contextual Stack</h2><p className="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-0.5">Live Session: {userProfile.name}_SR</p></div></div><Icon name="zap" size={18} className="text-blue-500 animate-pulse" />
                        </div>
                        <div className="p-8 space-y-10 overflow-y-auto scrollbar-hide">
                            <section className="space-y-5">
                                <div className="flex items-center gap-2"><Icon name="trending-up" size={14} className="text-slate-600" /><h3 className="text-[10px] font-black text-slate-600 uppercase tracking-widest">Active Intelligence</h3></div>
                                {dataCategories.map(cat => (
                                <div key={cat.id} className="bg-white/5 border border-white/10 rounded-3xl p-5 flex items-start gap-4 group hover:bg-white/10 transition-all cursor-default"><div className={`mt-1 p-2 rounded-xl bg-slate-900 border border-white/5 text-slate-500 group-hover:text-blue-400 transition-colors`}>{cat.id === 5 ? <Icon name="sparkles" size={16} /> : <Icon name="check-circle-2" size={16} />}</div><div className="flex-1 min-w-0"><p className="text-[11px] font-black text-white leading-none uppercase tracking-widest">{cat.name}</p><p className={`text-[10px] mt-2 leading-relaxed ${cat.id === 5 ? 'text-blue-400 font-bold italic' : 'text-slate-500 font-medium'}`}>{cat.detail}</p></div></div>
                                ))}
                            </section>
                            <section className="space-y-5">
                                <div className="flex items-center gap-2 text-blue-500"><Icon name="lightbulb" size={14} /><h3 className="text-[10px] font-black uppercase tracking-widest">Grounded Product Insights</h3></div>
                                <div className="grid grid-cols-1 gap-4">
                                {categoryInsights.map((insight, idx) => (
                                    <div key={idx} className="bg-gradient-to-br from-white/5 to-transparent border border-white/5 rounded-3xl p-5 space-y-3"><div className="flex items-center justify-between"><p className="text-[11px] font-black text-blue-100 uppercase tracking-tight italic">{insight.title}</p><div className="w-1.5 h-1.5 rounded-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div></div><p className="text-[10px] text-slate-500 font-medium leading-relaxed italic">"{insight.consensus}"</p><div className="flex items-center gap-2 pt-1 border-t border-white/5 mt-1"><span className="text-[8px] font-black text-slate-600 uppercase tracking-widest">Audience:</span><span className="text-[9px] text-blue-400 font-bold uppercase tracking-tighter">{insight.bestFor}</span></div></div>
                                ))}
                                </div>
                            </section>
                        </div>
                        <div className="mt-auto p-5 bg-black/60 border-t border-white/5 flex items-center justify-between font-mono text-[9px] text-slate-700 tracking-tighter uppercase shrink-0"><div className="flex items-center gap-5"><span className="flex items-center gap-1.5"><div className="w-1.5 h-1.5 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.5)]"></div> GEMINI_GEN_AI_READY</span><span className="opacity-50">latency: 28ms</span></div><span className="opacity-40">Ninja_Agent_v4.0</span></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
